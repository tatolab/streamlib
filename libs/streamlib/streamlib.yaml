# Copyright (c) 2025 Jonathan Fontanez
# SPDX-License-Identifier: BUSL-1.1

processors:
  # === Apple platform processors ===

  - name: com.tatolab.camera
    version: 1.0.0
    description: "Captures video from macOS cameras using AVFoundation"
    execution: manual
    config:
      name: config
      schema: com.tatolab.camera.config@1.0.0
    outputs:
      - name: video
        schema: com.tatolab.videoframe@1.0.0
        description: Live video frames from the camera

  - name: com.tatolab.display
    version: 1.0.0
    description: "Displays video frames in a window using Metal with vsync"
    execution: manual
    config:
      name: config
      schema: com.tatolab.display.config@1.0.0
    inputs:
      - name: video
        schema: com.tatolab.videoframe@1.0.0
        description: Video frames to display in the window

  - name: com.tatolab.audio_capture
    version: 1.0.0
    description: "Captures mono audio from macOS microphones in device-native format"
    execution: manual
    runtime:
      language: rust
      options:
        unsafe_send: true
    config:
      name: config
      schema: com.tatolab.audio_capture.config@1.0.0
    outputs:
      - name: audio
        schema: com.tatolab.audioframe@1.0.0
        description: Captured mono audio frames in device-native sample rate

  - name: com.tatolab.audio_output
    version: 1.0.0
    description: "Plays audio through speakers/headphones using CoreAudio"
    execution: manual
    runtime:
      language: rust
      options:
        unsafe_send: true
    config:
      name: config
      schema: com.tatolab.audio_output.config@1.0.0
    inputs:
      - name: audio
        schema: com.tatolab.audioframe@1.0.0
        description: Stereo audio frame to play through speakers

  - name: com.tatolab.mp4_writer
    version: 1.0.0
    description: "Writes stereo audio and video to MP4 file with A/V synchronization"
    execution: reactive
    runtime:
      language: rust
      options:
        unsafe_send: true
    config:
      name: config
      schema: com.tatolab.mp4_writer.config@1.0.0
    inputs:
      - name: audio
        schema: com.tatolab.audioframe@1.0.0
        description: Stereo audio frames to write to MP4
      - name: video
        schema: com.tatolab.videoframe@1.0.0
        description: Video frames to write to MP4

  - name: com.tatolab.screen_capture
    version: 1.0.0
    description: "Captures display, window, or application content using ScreenCaptureKit (macOS 12.3+)"
    execution: manual
    runtime:
      options:
        unsafe_send: true
    config:
      name: config
      schema: com.tatolab.screen_capture.config@1.0.0
    outputs:
      - name: video
        schema: com.tatolab.videoframe@1.0.0
        description: Captured video frames from screen content

  # === Core processors ===

  - name: com.streamlib.api_server
    version: 1.0.0
    description: "Runtime api server for streamlib"
    execution: manual
    config:
      name: config
      schema: com.streamlib.api_server.config@1.0.0

  - name: com.tatolab.simple_passthrough
    version: 1.0.0
    description: "Passes video frames through unchanged (for testing)"
    execution: manual
    config:
      name: config
      schema: com.tatolab.simple_passthrough.config@1.0.0
    inputs:
      - name: input
        schema: com.tatolab.videoframe@1.0.0
        description: Video frame input
    outputs:
      - name: output
        schema: com.tatolab.videoframe@1.0.0
        description: Video frame output (unchanged)

  - name: com.tatolab.audio_channel_converter
    version: 1.0.0
    description: "Converts mono audio to stereo using configurable channel mapping"
    execution: reactive
    config:
      name: config
      schema: com.tatolab.audio_channel_converter.config@1.0.0
    inputs:
      - name: audio_in
        schema: com.tatolab.audioframe@1.0.0
        description: Audio input (validates channel count at runtime)
    outputs:
      - name: audio_out
        schema: com.tatolab.audioframe@1.0.0
        description: Audio output with converted channel count

  - name: com.tatolab.audio_mixer
    version: 1.0.0
    description: "Mixes two mono signals (left and right) into a stereo signal"
    execution: reactive
    config:
      name: config
      schema: com.tatolab.audio_mixer.config@1.0.0
    inputs:
      - name: left
        schema: com.tatolab.audioframe@1.0.0
        description: Left channel mono audio (validates 1 channel at runtime)
      - name: right
        schema: com.tatolab.audioframe@1.0.0
        description: Right channel mono audio (validates 1 channel at runtime)
    outputs:
      - name: audio
        schema: com.tatolab.audioframe@1.0.0
        description: Mixed stereo audio output (2 channels)

  - name: com.tatolab.audio_resampler
    version: 1.0.0
    description: "Resamples audio from source to target sample rate (preserves channel count)"
    execution: reactive
    config:
      name: config
      schema: com.tatolab.audio_resampler.config@1.0.0
    inputs:
      - name: audio_in
        schema: com.tatolab.audioframe@1.0.0
        description: Audio input (any channel count)
    outputs:
      - name: audio_out
        schema: com.tatolab.audioframe@1.0.0
        description: Resampled audio output (same channel count as input)

  - name: com.tatolab.buffer_rechunker
    version: 1.0.0
    description: "Rechunks variable-sized audio buffers into fixed-size chunks (preserves channel count)"
    execution: reactive
    config:
      name: config
      schema: com.tatolab.buffer_rechunker.config@1.0.0
    inputs:
      - name: audio_in
        schema: com.tatolab.audioframe@1.0.0
        description: Variable-sized audio input (any channel count)
    outputs:
      - name: audio_out
        schema: com.tatolab.audioframe@1.0.0
        description: Fixed-size audio output (same channel count as input)

  - name: com.tatolab.chord_generator
    version: 1.0.0
    description: "Generates a C major chord (C4, E4, G4) pre-mixed into a stereo output"
    execution:
      type: Manual
    config:
      name: config
      schema: com.tatolab.chord_generator.config@1.0.0
    outputs:
      - name: chord
        schema: com.tatolab.audioframe@1.0.0
        description: Stereo audio output with C major chord (2 channels)

  - name: com.streamlib.clap.effect
    version: 1.0.0
    description: "CLAP audio plugin processor with parameter control and automation"
    execution: manual
    config:
      name: config
      schema: com.streamlib.clap.effect.config@1.0.0
    inputs:
      - name: audio_in
        schema: com.tatolab.audioframe@1.0.0
        description: Stereo audio frame to process through CLAP plugin (2 channels)
    outputs:
      - name: audio_out
        schema: com.tatolab.audioframe@1.0.0
        description: Processed stereo audio frame from CLAP plugin (2 channels)

  - name: com.streamlib.webrtc_whep
    version: 1.0.0
    description: "Receives video and audio from WHEP endpoint (WebRTC egress)"
    execution: manual
    runtime:
      language: rust
    config:
      name: config
      schema: com.streamlib.webrtc_whep.config@1.0.0
    outputs:
      - name: video_out
        schema: com.tatolab.videoframe@1.0.0
        description: Output video frames (decoded H.264)
      - name: audio_out
        schema: com.tatolab.audioframe@1.0.0
        description: Output audio frames (decoded Opus, stereo)

  - name: com.streamlib.webrtc_whip
    version: 1.0.0
    description: "Streams video and audio via WebRTC WHIP"
    execution: reactive
    runtime:
      language: rust
    config:
      name: config
      schema: com.streamlib.webrtc_whip.config@1.0.0
    inputs:
      - name: video_in
        schema: com.tatolab.videoframe@1.0.0
        description: Input video frames to encode and stream
      - name: audio_in
        schema: com.tatolab.audioframe@1.0.0
        description: Input audio frames to encode and stream

  # === Test mock processors ===

  - name: com.streamlib.test.mock_processor
    version: 1.0.0
    description: "Mock processor for testing graph operations"
    execution: manual
    inputs:
      - name: in1
        schema: com.tatolab.videoframe@1.0.0
        description: Test input port 1
      - name: in2
        schema: com.tatolab.videoframe@1.0.0
        description: Test input port 2
    outputs:
      - name: out1
        schema: com.tatolab.videoframe@1.0.0
        description: Test output port 1
      - name: out2
        schema: com.tatolab.videoframe@1.0.0
        description: Test output port 2

  - name: com.streamlib.test.mock_input_only_processor
    version: 1.0.0
    description: "Mock processor with only input ports for testing"
    execution: manual
    inputs:
      - name: in1
        schema: com.tatolab.videoframe@1.0.0
        description: Test input port 1
      - name: in2
        schema: com.tatolab.videoframe@1.0.0
        description: Test input port 2

  - name: com.streamlib.test.mock_output_only_processor
    version: 1.0.0
    description: "Mock processor with only output ports for testing"
    execution: manual
    outputs:
      - name: out1
        schema: com.tatolab.videoframe@1.0.0
        description: Test output port 1
      - name: out2
        schema: com.tatolab.videoframe@1.0.0
        description: Test output port 2

  # === Test attribute macro processors ===

  - name: com.streamlib.test.processor
    version: 1.0.0
    description: "Test processor for attribute macro tests"
    execution: manual
    inputs:
      - name: video_in
        schema: com.tatolab.videoframe@1.0.0
    outputs:
      - name: video_out
        schema: com.tatolab.videoframe@1.0.0

  - name: com.streamlib.test.configured_processor
    version: 1.0.0
    description: "Test processor with config for attribute macro tests"
    execution: continuous
    config:
      name: config
      schema: MyConfig
